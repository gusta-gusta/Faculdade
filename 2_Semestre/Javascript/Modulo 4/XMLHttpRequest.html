<!doctype html>
<html lang="pt-BR">
<head>
	<meta charset="utf-8">
	<title>Requisição XMLHttpRequest</title>
</head>
<body>
	<h1>Imagens Aleatórios de Cachorros</h1>
	<p> A partir do click no botão abaixo uma nova imagem aleatória de cachorros será carregada utilizando requisições assíncronas com XMLHttpRequest</p>
	<img id="img_dog" src="" alt="Aguardando a imagem ser carregada....." />
	<br/>
	<button onclick="carregarImagens()">Carregar Imagens</button>
</body>
	<script type="text/javascript">
    
		function carregarImagens(){
      
			var xmlHttpRequest = new XMLHttpRequest(); // uma instância do objeto é criada. Esse é o primeiro passo para sua utilização. A partir desse ponto, toda referência deverá ser feita pelo nome da variável utilizada (em nosso exemplo, xmlHttpRequest);
			var url = "https://dog.ceo/api/breeds/image/random"

			xmlHttpRequest.open("GET", url, true); // mostra a utilização do método open, que recebe 3 parâmetros: o método de requisição dos dados, a url remota/do servidor que queremos acessar e o tipo de requisição – onde “true” define que será feita uma requisição assíncrona e “false”, uma síncrona. Esse argumento é opcional. Logo, pode não ser definido, assumindo o valor padrão “true”

			xmlHttpRequest.onreadystatechange = function() { //temos a propriedade “onreadystatechange”, que monitora o status da requisição XMLHttpRequest – propriedade “readyState” − e especifica uma função a ser executada a cada mudança;
				if (xmlHttpRequest.readyState == 3) { // o status 3 significa que a requisição ainda está sendo processada. Logo, poderíamos, por exemplo, exibir em nossa tela uma mensagem (ou imagem, como é muito comum) avisando que a informação requisitada está sendo carregada. Perceba que, dependendo do tempo de resposta do servidor remoto, nem sempre será possível ver essa informação;
					console.log('Carregando o conteúdo....');
				}
				if (xmlHttpRequest.readyState == 4) { //  temos o tratamento do status quando ele for igual a 4, ou seja, quando a requisição estiver concluída. Além da propriedade “readyState”, poderíamos também monitorar a propriedade “status”, que armazena o código de resposta do servidor Http utilizado pela XMLHttpRequest;
                     
					var jsonExemplo = JSON.parse(xmlHttpRequest.responseText); // repare que também foi utilizado outro método, o parse. Esse método não pertence ao objeto XMLHttpRequest, mas este é necessário quando o recurso requisitado devolve o conteúdo em formato JSON;
       
					console.log('Requisição Finalizada');
					console.log('Resultado da Requisição: ' + jsonExemplo);
					console.log('Resultado da Requisição: ' + jsonExemplo.message);
        
					var imgDog = document.getElementById("img_dog");
					imgDog.src = jsonExemplo.message;
				}
			};
                 
			xmlHttpRequest.send(null); // é utilizado o método send, que envia a requisição.
    
		}
	</script>
</html>